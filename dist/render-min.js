!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var a in r)("object"==typeof exports?exports:e)[a]=r[a]}}(self,(()=>(()=>{var e={496:e=>{e.exports="#version 300 es\nprecision highp float;\n\n#define texture2D texture\n#define texture2DLodEXT textureLod\n#define textureCube texture\n\n#define varying in\n#define gl_FragColor outColor\nlayout (location = 0) out vec4 outColor;"},530:e=>{e.exports="#version 300 es\n\nvoid main(void) {\n\tvec2 vertex[4];\n\tvertex[0] = vec2(-1.0, -1.0);\n\tvertex[1] = vec2(-1.0,  1.0);\n\tvertex[2] = vec2( 1.0, -1.0);\n\tvertex[3] = vec2( 1.0,  1.0);\n\tgl_Position.xy = vertex[gl_VertexID];\n\tgl_Position.z = 0.0;\n\tgl_Position.w = 1.0;\n}"}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}var a={};return(()=>{var e=a;const t=document.createElement("canvas"),i=t.getContext("webgl2",{antialias:!0,depth:!1}),n=(i.getExtension("OES_texture_float_linear"),i.getExtension("EXT_color_buffer_float"),i.getExtension("EXT_float_blend"),r(530)),o=r(496);console.assert(i,"Web brwowser doesn't support webgl"),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.disable(i.STENCIL_TEST),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.pixelStorei(i.PACK_ALIGNMENT,1),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);const s=i.getParameter(i.MAX_VERTEX_ATTRIBS),l={CLAMP_TO_EDGE:i.CLAMP_TO_EDGE,REPEAT:i.REPEAT,MIRRORED_REPEAT:i.MIRRORED_REPEAT};e.WRAPS=l;const u={LINEAR:i.LINEAR,NEAREST:i.NEAREST};e.FILTERS=u;const c={UNSIGNED_BYTE:i.UNSIGNED_BYTE,HALF_FLOAT:i.HALF_FLOAT,FLOAT:i.FLOAT};e.BUFFER_TYPES=c;const h={RED:i.RED,RG:i.RG,RGB:i.RGB,RGBA:i.RGBA};e.FORMATS=h;const f={};f[c.UNSIGNED_BYTE]={},f[c.UNSIGNED_BYTE][h.RED]=i.R8,f[c.UNSIGNED_BYTE][h.RG]=i.RG8,f[c.UNSIGNED_BYTE][h.RGB]=i.RGB8,f[c.UNSIGNED_BYTE][h.RGBA]=i.RGBA8,f[c.HALF_FLOAT]={},f[c.HALF_FLOAT][h.RED]=i.R16F,f[c.HALF_FLOAT][h.RG]=i.RG16F,f[c.HALF_FLOAT][h.RGB]=i.RGB16F,f[c.HALF_FLOAT][h.RGBA]=i.RGBA16F,f[c.FLOAT]={},f[c.FLOAT][h.RED]=i.R32F,f[c.FLOAT][h.RG]=i.RG32F,f[c.FLOAT][h.RGB]=i.RGB32F,f[c.FLOAT][h.RGBA]=i.RGBA32F;const T={BOOL:i.BOOL,FLOAT:i.FLOAT,INT:i.INT,FLOAT_VEC2:i.FLOAT_VEC2,FLOAT_VEC3:i.FLOAT_VEC3,FLOAT_VEC4:i.FLOAT_VEC4,FLOAT_MAT2:i.FLOAT_MAT2,FLOAT_MAT3:i.FLOAT_MAT3,FLOAT_MAT4:i.FLOAT_MAT4,SAMPLER_2D:i.SAMPLER_2D};function E(e){this.settings=Object.assign({width:256,height:256,format:h.RGBA,type:c.FLOAT,wrap:{s:l.CLAMP_TO_EDGE,t:l.CLAMP_TO_EDGE},filter:{mag:u.LINEAR,min:u.LINEAR}},e),Object.defineProperty(this,"buffer",{value:i.createTexture(),writable:!1,enurabble:!1}),i.bindTexture(i.TEXTURE_2D,this.buffer),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,this.settings.wrap.s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,this.settings.wrap.t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,this.settings.filter.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.settings.filter.min),i.texImage2D(i.TEXTURE_2D,0,f[this.settings.type][this.settings.format],this.settings.width,this.settings.height,0,this.settings.format,this.settings.type,null)}function b(){let e,t;for(const r of arguments)r instanceof HTMLCanvasElement||r instanceof E?e=r:"object"!=typeof r||Array.isArray(r)||null===r||(t=r);this.settings=Object.assign({autoWires:{resolution:!0}},t);let r=null;Object.defineProperties(this,{target:{get:function(){return r},set:function(e){if(e!==r&&this.release(),e instanceof HTMLCanvasElement){let t=e.getContext("2d");Object.defineProperty(this,"render",{writable:!1,enurabble:!1,configurable:!0,value:function(e){this.settings.autoWires.resolution&&e.uniforms.resolution?.type==T.FLOAT_VEC2&&(e.uniforms.resolution.value=[r.width,r.height]),t.drawImage(e.render({width:r.width,height:r.height}),0,0,r.width,r.height)}}),Object.defineProperty(this,"release",{writable:!0,enurabble:!0,configurable:!0,value:function(){}})}else if(e instanceof E){let t=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,t),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.settings.width,e.settings.height);let a=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e.buffer,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t),Object.defineProperty(this,"render",{writable:!1,enurabble:!1,configurable:!0,value:function(e){this.settings.autoWires.resolution&&e.uniforms.resolution?.type==T.FLOAT_VEC2&&(e.uniforms.resolution.value=[r.settings.width,r.settings.height]),e.render({width:r.settings.width,height:r.settings.height,frameBuffer:a})}}),Object.defineProperty(this,"release",{writable:!0,enurabble:!0,configurable:!0,value:function(){i.deleteRenderbuffer(t),i.deleteFramebuffer(a)}})}r=e}}}),e&&(this.target=e)}e.UNIFORMS_TYPES=T,E.prototype.setData=function(e){i.bindTexture(i.TEXTURE_2D,this.buffer),i.texImage2D(i.TEXTURE_2D,0,f[this.settings.type][this.settings.format],this.settings.width,this.settings.height,0,this.settings.format,this.settings.type,e)},E.prototype.release=function(){i.deleteTexture(this.buffer)},E.FromImage=function(e){let t=new E({width:e.width,height:e.height});return t.setData(e),t},e.RenderingBuffer=E,b.prototype.release=function(){},e.RenderingTarget=b,e.RenderingProgram=function(e){var r=[0,0,0,0];this.settings=Object.assign({clearColor:r},e);const a=i.createProgram(),l=i.createShader(i.VERTEX_SHADER);i.shaderSource(l,n),i.compileShader(l),i.attachShader(a,l);var u=null;Object.defineProperties(this,{shaderProgram:{value:a,writable:!1,enurabble:!1},vertexShader:{value:l,writable:!1,enurabble:!1},source:{get:function(){return this.settings.source},set:function(e){if(u&&(i.detachShader(this.shaderProgram,u),i.deleteShader(u)),u=i.createShader(i.FRAGMENT_SHADER),i.shaderSource(u,o+e),i.compileShader(u),!i.getShaderParameter(u,i.COMPILE_STATUS))throw new Error("An error occurred compiling the PixelShaders: "+i.getShaderInfoLog(u));i.attachShader(this.shaderProgram,u),i.linkProgram(this.shaderProgram),this.settings.source=e,this.uniforms={};const t=i.getProgramParameter(this.shaderProgram,i.ACTIVE_UNIFORMS);for(let e=0;e<t;++e){const t=i.getActiveUniform(this.shaderProgram,e);switch(t.type){case i.BOOL:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.BOOL,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:!1,enumerable:!0,writable:!0}});break;case i.INT:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.INT,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:0,enumerable:!0,writable:!0}});break;case i.FLOAT:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:0,enumerable:!0,writable:!0}});break;case i.FLOAT_VEC4:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_VEC4,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:[0,0,0,0],enumerable:!0,writable:!0}});break;case i.FLOAT_VEC3:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_VEC3,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:[0,0,0],enumerable:!0,writable:!0}});break;case i.FLOAT_VEC2:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_VEC2,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:[0,0],enumerable:!0,writable:!0}});break;case i.FLOAT_MAT4:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_MAT4,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:new Float32Array(16),enumerable:!0,writable:!0}});break;case i.FLOAT_MAT3:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_MAT3,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:new Float32Array(9),enumerable:!0,writable:!0}});break;case i.FLOAT_MAT2:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.FLOAT_MAT2,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:new Float32Array(4),enumerable:!0,writable:!0}});break;case i.SAMPLER_2D:this.uniforms[t.name]=Object.create(Object.prototype,{type:{value:T.SAMPLER_2D,enumerable:!0},location:{value:i.getUniformLocation(this.shaderProgram,t.name),enumerable:!0},value:{value:null,enumerable:!0,writable:!0}})}}}},clearColor:{get:function(){return this.settings.clearColor},set:function(e){this.settings.clearColor=e,r=e}},render:{writable:!1,enurabble:!0,value:function(e){if(e instanceof b)return e.render(this);var a=Object.assign({width:640,height:480,frameBuffer:null},e);t.width=a.width,t.height=a.height,i.bindFramebuffer(i.FRAMEBUFFER,a.frameBuffer),i.viewport(0,0,a.width,a.height),i.scissor(0,0,a.width,a.height),i.clearColor.apply(i,r),i.clear(i.COLOR_BUFFER_BIT);for(var n=0;n<s;++n)i.disableVertexAttribArray(n);i.useProgram(this.shaderProgram);let o=0;for(const e of Object.values(this.uniforms))switch(e.type){case T.BOOL:i.uniform1i(e.location,e.value?1:0);break;case T.INT:i.uniform1i(e.location,e.value);break;case T.FLOAT:i.uniform1f(e.location,e.value);break;case T.FLOAT_VEC4:i.uniform4fv(e.location,e.value);break;case T.FLOAT_VEC3:i.uniform3fv(e.location,e.value);break;case T.FLOAT_VEC2:i.uniform2fv(e.location,e.value);break;case T.FLOAT_MAT4:i.uniformMatrix4fv(e.location,!1,e.value);break;case T.FLOAT_MAT3:i.uniformMatrix3fv(e.location,!1,e.value);break;case T.FLOAT_MAT2:i.uniformMatrix2fv(e.location,!1,e.value);break;case T.SAMPLER_2D:e.value instanceof E&&(i.uniform1i(e.location,o),i.activeTexture(i.TEXTURE0+o),i.bindTexture(i.TEXTURE_2D,e.value.buffer),o+=1)}return i.drawArrays(i.TRIANGLE_STRIP,0,4),t}},release:{value:function(){u&&(i.detachShader(this.shaderProgram,u),i.deleteShader(u)),i.detachShader(this.shaderProgram,l),i.deleteShader(l),i.deleteProgram(a)}}}),this.settings.source&&(this.source=this.settings.source)}})(),a})()));